<html lang="en-us">
<script src="https://pygame-web.github.io/archives/0.9/pythons.js" type=module id=site data-LINES=57 data-CONSOLE=25
    data-python=python3.12 data-os=vtx,fs,snd,gui async defer>#<!--

print("V112 SUPREME: Booting sequence initiated...")

async def custom_site():
    import sys, asyncio, platform, json, os
    from pathlib import Path
    import embed, pygame

    def log(msg):
        print(f"BOOTLOG: {msg}")
        try: platform.window.document.getElementById("status-text").innerHTML = msg
        except: pass

    try:
        platform.document.body.style.background = "#050510"
        pygame.init()
        
        # Hide standard Pygbag progress bar if possible
        try: platform.window.transfer.hidden = True
        except: pass
        
        platform.window.canvas.style.visibility = "visible"

        apk = "eng_v112.data"
        bundle = "mario_supreme_v112"
        appdir = Path(f"/data/data/{bundle}")
        appdir.mkdir(parents=True, exist_ok=True)

        log("Step 1: Fetching match engine...")
        cfg = {"io": "url", "type":"mount", "mount" : {"point" : appdir.as_posix(), "path" : "/"}, "path" : f"/ => {appdir.as_posix()}"}
        track = platform.window.MM.prepare(apk, json.dumps(cfg))
        while not track.ready: await asyncio.sleep(.1)

        log("Step 2: Preparing simulation...")
        platform.run_main(PyConfig, loaderhome= appdir / "assets", loadermain=None)
        while embed.counter()<0: await asyncio.sleep(.1)

        main = appdir / "assets" / "main.py"
        if not main.exists(): main = appdir / "main.py" 
        
        await TopLevel_async_handler.start_toplevel(platform.shell, console=window.python.config.debug)
        __import__(__name__).__file__ = str(main)

        log("ARENA READY. Press ENTER below.")
        
        # Wait for user engagement (Standard browser requirement)
        while True:
            try:
                if platform.window.MM.UME: break
            except: pass
            await asyncio.sleep(.1)

        log("Entering game...")
        await shell.runpy(main)
    except Exception as e:
        print(f"FATAL BOOT ERROR: {e}")
        log(f"BOOT FAILED: {e}")

import asyncio
asyncio.run(custom_site())

# BEGIN BLOCK
# =============================================================================
# --></script>

<head>
    <script type="application/javascript">
        // This is necessary to bridge the gap between HTML and Pygame
        config = { xtermjs: "1", _sdl2: "canvas", user_canvas: 0, user_canvas_managed: 0, ume_block: 1, archive: "mario_v112", gui_debug: 3, cdn: "https://pygame-web.github.io/archives/0.9/", autorun: 0, PYBUILD: "3.12" }
        function unlock() {
            window.MM.UME = true;
            document.getElementById('super-lock').style.display = 'none';
        }
    </script>
    <title>MARIO MATCH V112</title>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        body {
            margin: 0;
            background-color: #050510;
            font-family: 'Segoe UI', Arial, sans-serif;
            overflow: hidden;
            color: white;
        }

        canvas.emscripten {
            border: 0;
            background: transparent;
            width: 100%;
            height: 100%;
            z-index: 5;
            position: absolute;
            top: 0;
            left: 0;
        }

        #super-lock {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #050510;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            text-align: center;
        }

        #lock-btn {
            padding: 40px 80px;
            font-size: 32px;
            background: #00ffcc;
            color: #000;
            border: none;
            border-radius: 20px;
            font-weight: bold;
            box-shadow: 0 0 50px rgba(0, 255, 204, 0.4);
            cursor: pointer;
            margin-bottom: 30px;
            transition: 0.2s;
        }

        #lock-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 70px rgba(0, 255, 204, 0.6);
        }

        #status-text {
            color: #00ffcc;
            font-family: monospace;
            font-size: 20px;
            letter-spacing: 2px;
        }

        #pyconsole {
            display: none !important;
        }
    </style>
</head>

<body>
    <div id="super-lock" onclick="unlock()">
        <button id="lock-btn">ENTER MATCH ARENA</button>
        <div id="status-text">WAITING FOR ENGINE...</div>
    </div>
    <div id="transfer" align=center>
        <div class="emscripten" id="status"></div>
    </div>
    <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()" tabindex=1></canvas>
</body>

</html>