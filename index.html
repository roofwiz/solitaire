<html lang="en-us">
<script src="https://pygame-web.github.io/archives/0.9/pythons.js" type=module id=site data-LINES=57 data-CONSOLE=25
    data-python=python3.12 data-os=vtx,fs,snd,gui async defer>#<!--

# SILENT LOADER - No console prints
async def custom_site():
    import sys
    import asyncio
    import platform
    import json
    from pathlib import Path
    import embed

    platform.document.body.style.background = "#000"

    import pygame

    def compose():
        pygame.display.update()
        window.chromakey(None, *screen.get_colorkey(), 40)

    pygame.init()
    pygame.font.init()

    # Smallest possible initial surface
    screen = pygame.display.set_mode([1,1], pygame.SRCALPHA, 32)
    screen.set_colorkey( (0,0,0,0), pygame.RLEACCEL )
    screen.fill( (0,0,0,0) )

    compose()

    platform.window.transfer.hidden = true
    platform.window.canvas.style.visibility = "visible"

    apk = "mario-tetris-v29.apk"
    bundle = "mario-tetris-main"

    appdir = Path(f"/data/data/mario-tetris-main")
    if not appdir.exists():
        appdir.mkdir()

    cfg = {
        "io": "url",
        "type":"mount",
        "mount" : {
            "point" : appdir.as_posix(),
            "path" : "/",
        },
        "path" : f"/ => {appdir.as_posix()}",
    }

    track = platform.window.MM.prepare(apk, json.dumps(cfg))

    while not track.ready:
        await asyncio.sleep(.1)

    platform.run_main(PyConfig, loaderhome= appdir / "assets", loadermain=None)

    while embed.counter()<0:
        await asyncio.sleep(.1)

    main = appdir / "assets" / "main.py"
    await TopLevel_async_handler.start_toplevel(platform.shell, console=window.python.config.debug)
    __import__(__name__).__file__ = str(main)

    if not platform.window.MM.UME:
        # Define the font only when needed
        fnt = pygame.sysfont.SysFont("freesans",  60 )
        prompt = fnt.render("Ready to start Polished Mario!", True, "#FF1493")
        # Center the text for web interaction
        tw, th = prompt.get_size()
        
        # We need a surface to draw on for the prompt
        screen = pygame.display.set_mode([1024, 600], pygame.SRCALPHA, 32)
        screen.fill((0,0,0,0))
        screen.blit(prompt, (512 - tw//2, 300 - th//2))
        pygame.display.flip()
        
        while not platform.window.MM.UME:
            await asyncio.sleep(.1)

    screen.fill( (0,0,0,0) )
    pygame.display.flip()
    await shell.runpy(main)

import asyncio
asyncio.run( custom_site() )

# BEGIN BLOCK
# =============================================================================
# --></script>

<head>
    <script type="application/javascript">

        config = {
            xtermjs: "1",
            _sdl2: "canvas",
            user_canvas: 0,
            user_canvas_managed: 0,
            ume_block: 1,
            can_close: 0,
            archive: "mario-tetris-main",
            gui_debug: 0,
            cdn: "https://pygame-web.github.io/archives/0.9/",
            autorun: 1,
            PYBUILD: "3.12"
        }

    </script>

    <title>Mario Tetris Polished</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="favicon.png" sizes="16x16">
    <style>
        body {
            font-family: arial;
            margin: 0;
            background-color: #000;
            overflow: hidden;
        }

        canvas.emscripten {
            border: 0px none;
            background-color: transparent;
            width: 100vw;
            height: 100vh;
            z-index: 5;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            object-fit: contain;
        }

        #pyconsole {
            display: none !important;
            position: absolute;
            top: -1000px;
            height: 1px;
            width: 1px;
            visibility: hidden;
        }

        #transfer {
            display: none !important;
            visibility: hidden;
        }

        #loading-text {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #FF1493;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 1.5rem;
            letter-spacing: 2px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 0.4;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.4;
            }
        }
    </style>
</head>

<body>
    <div id="loading-text">SYNCING ADVENTURE...</div>
    <div id="transfer"></div>
    <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()" tabindex=1></canvas>
    <div id="pyconsole"></div>
    <script>
        // Force hide everything except loading text until UME
        window.addEventListener('mousedown', function () {
            document.getElementById('loading-text').style.display = 'none';
        }, { once: true });
        window.addEventListener('keydown', function () {
            document.getElementById('loading-text').style.display = 'none';
        }, { once: true });
    </script>
</body>

</html>